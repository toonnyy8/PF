<!doctype html>
<html>

<head>
    <script src="./include.js"></script>
    <link href=".\Flat-UI-master\dist\css\vendor\bootstrap\css\bootstrap.min.css" rel="stylesheet">
    <link href=".\Flat-UI-master\dist\css\flat-ui.min.css" rel="stylesheet">
    <script>
        window.$ = window.jQuery = require("./Flat-UI-master/dist/js/vendor/jquery.min.js");
    </script>
    <script src="./Flat-UI-master/dist/js/flat-ui.min.js" rel="stylesheet"></script>
    <script src="./Flat-UI-master/docs/assets/js/prettify.js" rel="stylesheet"></script>
    <script src="./Flat-UI-master/docs/assets/js/application.js" rel="stylesheet"></script>
    <meta charset="utf-8">
    <title>Pixel Fighter</title>
</head>

<body style="background-color:#000000;">
    <!--<script>
        screenset = function(x = 1) {
            window.onload = function() {
                window.resizeTo(220 * x + 30, 121 * x + 60);
            };
            window.onresize = function() {
                window.resizeTo(220 * x + 30, 121 * x + 60);
            };
        };
        screenset(screen_scale * 8);
    </script>-->
    <script>
        "use strict";

        let path = './resources/app/chara/';
        let chara_ = [];
        let charas = fs.readdirSync(path);
        let select = 0;
        let select_actor = function(n) {
            select = n;
            for (let i = 0; i < charas.length; i++) {
                chara_[i].style = "background-color:rgb(0, 0, 0);padding:1px;margin-bottom:5px;text-align:center;";
            }
            chara_[select].style = "background-color:rgb(255, 255, 255);padding:1px;margin-bottom:5px;text-align:center;";
            document.getElementById("choose").style = "display: none";
            document.getElementById("basic_data").style = "";
            document.getElementById("ActorName").innerHTML = '<h3 style="color:rgb(255, 0, 85);font-family:Microsoft JhengHei;">' + charas[select] + '</h3>';
            Basic(path + charas[select] + '/player.json');
        };

        document.write("<div id='choose'>");
        for (let i = 0; i < charas.length; i++) {
            document.write('<a onclick="select_actor(' + i + ');"><div id=' + i + ' style="background-color:rgb(0, 0, 0);padding:1px;margin-bottom:5px;text-align:center;"></div></a>');
            chara_[i] = document.getElementById(i);
            chara_[i].innerHTML = '<h3 style="color:rgb(255, 0, 85);font-family:Microsoft JhengHei;">' + charas[i] + '</h3>';
        };
        document.write('</div></div>');
        chara_[0].style = "background-color:rgb(255, 255, 255);padding:1px;margin-bottom:5px;text-align:center;";
        window.onkeydown = function() {
            if (event.keyCode == 27) {
                window.location.href = "./index.html";
            };
            if ((event.keyCode == 40 || event.keyCode == 83) && select < charas.length - 1) {
                select++;
            } else if ((event.keyCode == 38 || event.keyCode == 87) && select > 0) {
                select--;
            }
            if (select >= 0 && select <= charas.length - 1) {
                chara_[select].style = "background-color:rgb(255, 255, 255);padding:1px;margin-bottom:5px;text-align:center;";

            }

            document.body.scrollTop = select * 84; //控制卷軸位置
            if (select > 0) {
                chara_[select - 1].style = "background-color:rgb(0,0,0);padding:1px;margin-bottom:5px;text-align:center;";
            }
            if (select < charas.length - 1) {
                chara_[select + 1].style = "background-color:rgb(0,0,0);padding:1px;margin-bottom:5px;text-align:center;";
            }

            if (event.keyCode == 13) {
                select_actor(select);
            }
        }
    </script>
    <div id="basic_data">
        <a href="./PF.basic.html">
            <div id='ActorName' style="background-color:rgb(255, 255, 255);padding:1px;margin-bottom:5px;text-align:center;"></div>
        </a>
        <div class="input-group">
            <span class="input-group-addon">角色最大HP</span>
            <input id="Max_HP" type="number" class="form-control" min="1" value="" style="color:rgb(0, 62, 143);font-family:Microsoft JhengHei;" />
        </div>
        <div style="padding:10px;margin-bottom:5px;"></div>
        <div class="input-group">
            <span class="input-group-addon">角色現有HP</span>
            <input id="Now_HP" type="number" class="form-control" min="0" value="" style="color:rgb(0, 62, 143);font-family:Microsoft JhengHei;" />
        </div>
        <div style="padding:10px;margin-bottom:5px;"></div>
        <div class="input-group">
            <span class="input-group-addon">角色最大MP</span>
            <input id="Max_MP" type="number" class="form-control" min="1" value="" style="color:rgb(0, 62, 143);font-family:Microsoft JhengHei;" />
        </div>
        <div style="padding:10px;margin-bottom:5px;"></div>
        <div class="input-group">
            <span class="input-group-addon">角色現有MP</span>
            <input id="Now_MP" type="number" class="form-control" min="0" value="" style="color:rgb(0, 62, 143);font-family:Microsoft JhengHei;" />
        </div>
        <div style="padding:10px;margin-bottom:5px;"></div>
        <div class="input-group">
            <span class="input-group-addon">角色每hit回復多少MP</span>
            <input id="Hit_MP" type="number" class="form-control" value="" style="color:rgb(0, 62, 143);font-family:Microsoft JhengHei;" />
        </div>
        <div style="padding:10px;margin-bottom:5px;"></div>
        <div class="input-group">
            <span class="input-group-addon">角色受攻擊回復多少MP</span>
            <input id="Hurt_MP" type="number" class="form-control" value="" style="color:rgb(0, 62, 143);font-family:Microsoft JhengHei;" />
        </div>
        <div style="padding:10px;margin-bottom:5px;"></div>
        <div class="input-group">
            <span class="input-group-addon">角色站立Mode演出的動作(用.連接)</span>
            <input id="stand_Mode" type="text" class="form-control" value="" style="color:rgb(0, 62, 143);font-family:Microsoft JhengHei;" />
        </div>
        <div style="padding:10px;margin-bottom:5px;"></div>
        <div class="input-group">
            <span class="input-group-addon">角色站立實際的判定圖(Ability，用.連接)</span>
            <input id="stand_Ability" type="text" class="form-control" value="" style="color:rgb(0, 62, 143);font-family:Microsoft JhengHei;" />
        </div>
        <div style="padding:10px;margin-bottom:5px;"></div>
        <div class="input-group">
            <span class="input-group-addon">角色站立受攻擊後自動切換的動作(不影響就不填)</span>
            <input id="stand_change_action" type="number" min="0" class="form-control" value="" style="color:rgb(0, 62, 143);font-family:Microsoft JhengHei;" />
        </div>
        <div style="padding:10px;margin-bottom:5px;"></div>
        <div class="input-group">
            <span class="input-group-addon">角色幀率</span>
            <input id="fps" type="number" min="1" max="60" class="form-control" value="" style="color:rgb(0, 62, 143);font-family:Microsoft JhengHei;" />
        </div>
        <div style="padding:10px;margin-bottom:5px;"></div>
        <input id="save" type="button" onclick="savedata();" class="btn btn-block btn-lg btn-info" value="儲存">

        <script>
            "use strict";
            document.getElementById("basic_data").style = "display: none";
            let data;
            let json_path
            var Basic = function(path) {
                json_path = path;
                data = fs.readFileSync(json_path, 'utf8');
                data = JSON.parse(data);

                document.getElementById("Max_HP").value = data["HP"].split("_")[0];
                document.getElementById("Now_HP").max = data["HP"].split("_")[0];
                document.getElementById("Now_HP").value = data["HP"].split("_")[1];
                document.getElementById("Max_MP").value = data["MP"].split("_")[0];
                document.getElementById("Now_MP").max = data["MP"].split("_")[0];
                document.getElementById("Now_MP").value = data["MP"].split("_")[1];
                document.getElementById("Hit_MP").value = data["MP"].split("_")[2];
                document.getElementById("Hurt_MP").value = data["MP"].split("_")[3];
                document.getElementById("stand_Mode").value = data["stand"].split("_")[0];
                document.getElementById("stand_Ability").value = data["stand"].split("_")[1];
                document.getElementById("stand_change_action").value = data["stand"].split("_")[2];
                document.getElementById("fps").value = data["FPS"];

                window.onkeydown = function() {
                    if (event.keyCode == 27) {
                        window.location.href = "./PF.basic.html";
                    }
                }

            };
            var savedata = function() {
                if (document.getElementById("Max_HP").value == "") {
                    data["HP"] = "" + 10000;
                } else {
                    data["HP"] = "" + document.getElementById("Max_HP").value;
                };
                if (document.getElementById("Now_HP").value == "") {
                    data["HP"] += "_" + 10000;
                } else {
                    data["HP"] += "_" + document.getElementById("Now_HP").value;
                };
                if (document.getElementById("Max_MP").value == "") {
                    data["MP"] = "" + 10000;
                } else {
                    data["MP"] = "" + document.getElementById("Max_MP").value;
                };
                if (document.getElementById("Now_MP").value == "") {
                    data["MP"] += "_" + 10000;
                } else {
                    data["MP"] += "_" + document.getElementById("Now_MP").value;
                };
                if (document.getElementById("Hit_MP").value == "") {
                    data["MP"] += "_" + 100;
                } else {
                    data["MP"] += "_" + document.getElementById("Hit_MP").value;
                };
                if (document.getElementById("Hurt_MP").value == "") {
                    data["MP"] += "_" + 100;
                } else {
                    data["MP"] += "_" + document.getElementById("Hurt_MP").value;
                };
                if (document.getElementById("stand_Mode").value == "") {
                    data["stand"] = "0";
                } else {
                    data["stand"] = document.getElementById("stand_Mode").value;
                };
                if (document.getElementById("stand_Ability").value == "") {
                    data["stand"] += "_0";
                } else {
                    data["stand"] += "_" + document.getElementById("stand_Ability").value;
                };
                if (document.getElementById("stand_change_action").value == "") {
                    data["stand"] += "_null";
                } else {
                    data["stand"] += "_" + document.getElementById("stand_change_action").value;
                };
                if (document.getElementById("fps").value == "") {
                    data["FPS"] = 30;
                } else {
                    data["FPS"] = document.getElementById("fps").value;
                };

                fs.writeFile(json_path, JSON.stringify(data), function(err) {
                    if (err) {
                        console.log(err);
                        alert(err);
                    } else {
                        console.log("save player.json");
                    };
                });
            };
        </script>
    </div>
</body>

</html>